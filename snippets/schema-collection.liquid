{%- comment -%}
  Collection Schema (JSON-LD)
  Outputs CollectionPage structured data for collection pages
  Usage: {% render 'schema-collection', collection: collection %}
{%- endcomment -%}

{%- if collection -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": {{ collection.title | json }},
  "url": {{ collection.url | prepend: shop.url | json }},
  "description": {{ collection.description | strip_html | truncate: 5000 | json }},
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ collection.products_count | json }},
    "itemListElement": [
      {%- for product in collection.products limit: 10 -%}
      {
        "@type": "ListItem",
        "position": {{ forloop.index | json }},
        "item": {
          "@type": "Product",
          "name": {{ product.title | json }},
          "url": {{ product.url | prepend: shop.url | json }},
          "image": {{ product.featured_image | image_url: width: 1200 | json }},
          "offers": {
            "@type": "Offer",
            "price": {{ product.price | divided_by: 100.0 | json }},
            "priceCurrency": {{ cart.currency.iso_code | json }},
            "availability": "https://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}"
          }
        }
      }{%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    ]
  }
  {%- if collection.image -%}
  ,"image": {{ collection.image | image_url: width: 1200 | json }}
  {%- endif -%}
}
</script>
{%- endif -%}