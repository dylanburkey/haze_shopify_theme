{%- comment -%}
  BreadcrumbList Schema (JSON-LD)
  Generates breadcrumb structured data based on current page
{%- endcomment -%}

{%- liquid
  assign breadcrumb_items = '' | split: ','

  case template.name
    when 'product'
      if product.collections.size > 0
        assign primary_collection = product.collections.first
        assign breadcrumb_items = breadcrumb_items | concat: primary_collection.title | split: '|||'
      endif
      assign breadcrumb_items = breadcrumb_items | concat: product.title | split: '|||'

    when 'collection'
      assign breadcrumb_items = breadcrumb_items | concat: collection.title | split: '|||'

    when 'article'
      assign breadcrumb_items = breadcrumb_items | concat: blog.title | split: '|||'
      assign breadcrumb_items = breadcrumb_items | concat: article.title | split: '|||'

    when 'blog'
      assign breadcrumb_items = breadcrumb_items | concat: blog.title | split: '|||'

    when 'page'
      assign breadcrumb_items = breadcrumb_items | concat: page.title | split: '|||'

    when 'search'
      assign breadcrumb_items = breadcrumb_items | concat: 'Search Results' | split: '|||'

    when 'cart'
      assign breadcrumb_items = breadcrumb_items | concat: 'Cart' | split: '|||'
  endcase
-%}

{%- if breadcrumb_items.size > 0 -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ shop.url | json }}
    }
    {%- assign position = 2 -%}
    {%- case template.name -%}
      {%- when 'product' -%}
        {%- if product.collections.size > 0 -%}
        ,{
          "@type": "ListItem",
          "position": {{ position }},
          "name": {{ product.collections.first.title | json }},
          "item": {{ product.collections.first.url | prepend: shop.url | json }}
        }
        {%- assign position = position | plus: 1 -%}
        {%- endif -%}
        ,{
          "@type": "ListItem",
          "position": {{ position }},
          "name": {{ product.title | json }},
          "item": {{ product.url | prepend: shop.url | json }}
        }

      {%- when 'collection' -%}
        ,{
          "@type": "ListItem",
          "position": {{ position }},
          "name": {{ collection.title | json }},
          "item": {{ collection.url | prepend: shop.url | json }}
        }

      {%- when 'article' -%}
        ,{
          "@type": "ListItem",
          "position": {{ position }},
          "name": {{ blog.title | json }},
          "item": {{ blog.url | prepend: shop.url | json }}
        }
        {%- assign position = position | plus: 1 -%}
        ,{
          "@type": "ListItem",
          "position": {{ position }},
          "name": {{ article.title | json }},
          "item": {{ article.url | prepend: shop.url | json }}
        }

      {%- when 'blog' -%}
        ,{
          "@type": "ListItem",
          "position": {{ position }},
          "name": {{ blog.title | json }},
          "item": {{ blog.url | prepend: shop.url | json }}
        }

      {%- when 'page' -%}
        ,{
          "@type": "ListItem",
          "position": {{ position }},
          "name": {{ page.title | json }},
          "item": {{ page.url | prepend: shop.url | json }}
        }
    {%- endcase -%}
  ]
}
</script>
{%- endif -%}
