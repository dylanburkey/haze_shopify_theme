{% comment %}
  Product Comparison Section
  Displays comparison controls and comparison table
{% endcomment %}

<section class="product-comparison-section" data-section-id="{{ section.id }}" data-preset="{{ settings.theme_preset | default: 'the-welder' }}">
  <div class="container">
    {%- if section.settings.show_comparison_controls -%}
      <div class="comparison-controls" data-comparison-controls>
        <div class="comparison-controls__header">
          <h3 class="comparison-controls__title">{{ section.settings.title | default: 'Product Comparison' }}</h3>
          <div class="comparison-controls__counter">
            <span class="comparison-counter" data-comparison-counter>0</span>
            <span class="comparison-counter__max">/ 4 products</span>
          </div>
        </div>

        <div class="comparison-controls__actions">
          <button 
            type="button" 
            class="button button--secondary comparison-controls__add-btn" 
            data-add-to-comparison
            data-product-id="{{ product.id }}"
            data-product-handle="{{ product.handle }}"
            style="display: none;"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            {{ section.settings.add_button_text | default: 'Add to Comparison' }}
          </button>

          <button 
            type="button" 
            class="button button--outline comparison-controls__remove-btn" 
            data-remove-from-comparison
            data-product-id="{{ product.id }}"
            style="display: none;"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
            {{ section.settings.remove_button_text | default: 'Remove from Comparison' }}
          </button>

          <button 
            type="button" 
            class="button button--primary comparison-controls__view-btn" 
            data-view-comparison
            style="display: none;"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            {{ section.settings.view_button_text | default: 'View Comparison' }}
          </button>

          <button 
            type="button" 
            class="button button--outline comparison-controls__clear-btn" 
            data-clear-comparison
            style="display: none;"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            {{ section.settings.clear_button_text | default: 'Clear All' }}
          </button>
        </div>

        {%- if section.settings.show_product_list -%}
          <div class="comparison-controls__products" data-comparison-products>
            <div class="comparison-product-list" data-comparison-product-list>
              <!-- Products will be dynamically added here -->
            </div>
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if section.settings.show_comparison_table -%}
      <div class="comparison-display" data-comparison-display>
        <div class="comparison-display__header">
          <h3 class="comparison-display__title">{{ section.settings.comparison_title | default: 'Product Comparison' }}</h3>
          <div class="comparison-display__actions">
            <button 
              type="button" 
              class="button button--outline comparison-display__export-btn" 
              data-export-comparison
              style="display: none;"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              {{ section.settings.export_button_text | default: 'Export PDF' }}
            </button>

            <button 
              type="button" 
              class="button button--outline comparison-display__share-btn" 
              data-share-comparison
              style="display: none;"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
              </svg>
              {{ section.settings.share_button_text | default: 'Share' }}
            </button>
          </div>
        </div>

        <div class="comparison-table-container" data-comparison-table>
          <div class="comparison-empty-state" data-comparison-empty>
            <div class="comparison-empty-state__icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
              </svg>
            </div>
            <h4 class="comparison-empty-state__title">{{ section.settings.empty_title | default: 'No Products to Compare' }}</h4>
            <p class="comparison-empty-state__description">{{ section.settings.empty_description | default: 'Add products to comparison to see side-by-side specifications.' }}</p>
          </div>
          <!-- Comparison table will be dynamically rendered here -->
        </div>
      </div>
    {%- endif -%}
  </div>
</section>

<script type="application/json" data-comparison-config>
{
  "maxProducts": {{ section.settings.max_products | default: 4 }},
  "autoShow": {{ section.settings.auto_show_comparison | default: true | json }},
  "persistState": {{ section.settings.persist_state | default: true | json }},
  "showDifferences": {{ section.settings.highlight_differences | default: true | json }},
  "mobileStackLayout": {{ section.settings.mobile_stack_layout | default: true | json }}
}
</script>

{% stylesheet %}
  .product-comparison-section {
    margin: 2rem 0;
    /* Theme integration */
    --comparison-font-family: var(--font-body, var(--font-body-family, system-ui));
    --comparison-heading-font: var(--font-heading, var(--font-heading-family, system-ui));
    --comparison-primary: var(--color-primary, var(--color-accent, #3b82f6));
    --comparison-text: var(--color-text, var(--color-foreground, #1a1a1a));
    --comparison-text-secondary: var(--color-text-secondary, var(--color-foreground-secondary, #6b7280));
    --comparison-background: var(--color-background, #ffffff);
    --comparison-surface: var(--color-background-secondary, var(--color-surface, #f8f8f8));
    --comparison-border: var(--color-border, var(--color-border-input, #e5e5e5));
    --comparison-radius: var(--radius-card, var(--card-border-radius, 0.5rem));
    --comparison-transition: var(--duration-fast, var(--transition-duration, 0.15s)) var(--ease-default, ease);
  }

  /* Comparison Controls - Theme integrated */
  .comparison-controls {
    background: var(--comparison-surface);
    border: 1px solid var(--comparison-border);
    border-radius: var(--comparison-radius);
    padding: var(--space-6, 1.5rem);
    margin-bottom: var(--space-8, 2rem);
    font-family: var(--comparison-font-family);
  }

  .comparison-controls__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-4, 1rem);
  }

  .comparison-controls__title {
    margin: 0;
    font-family: var(--comparison-heading-font);
    font-size: var(--font-size-xl, 1.25rem);
    font-weight: var(--font-heading-weight, 600);
    color: var(--comparison-text);
  }

  .comparison-controls__counter {
    display: flex;
    align-items: center;
    gap: var(--space-1, 0.25rem);
    font-size: var(--font-size-sm, 0.875rem);
    color: var(--comparison-text-secondary);
  }

  .comparison-counter {
    font-weight: 600;
    color: var(--comparison-primary);
  }

  .comparison-controls__actions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .comparison-controls__actions .button {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
  }

  .comparison-controls__actions .button svg {
    margin-right: 0.5rem;
  }

  /* Product List */
  .comparison-controls__products {
    border-top: 1px solid var(--color-border, #e5e5e5);
    padding-top: 1rem;
  }

  .comparison-product-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .comparison-product-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--color-background);
    border: 1px solid var(--color-border, #e5e5e5);
    border-radius: calc(var(--border-radius, 0.5rem) * 0.5);
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
  }

  .comparison-product-item__image {
    width: 2rem;
    height: 2rem;
    object-fit: cover;
    border-radius: calc(var(--border-radius, 0.5rem) * 0.25);
  }

  .comparison-product-item__name {
    font-weight: 500;
    color: var(--color-foreground);
  }

  .comparison-product-item__remove {
    background: none;
    border: none;
    color: var(--color-foreground-secondary, #666);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 50%;
    transition: all 0.2s ease;
  }

  .comparison-product-item__remove:hover {
    background: var(--color-error, #dc2626);
    color: white;
  }

  /* Comparison Display */
  .comparison-display {
    margin-top: 2rem;
  }

  .comparison-display__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .comparison-display__title {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--color-foreground);
  }

  .comparison-display__actions {
    display: flex;
    gap: 0.75rem;
  }

  .comparison-display__actions .button {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
  }

  .comparison-display__actions .button svg {
    margin-right: 0.5rem;
  }

  /* Empty State */
  .comparison-empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--color-foreground-secondary, #666);
  }

  .comparison-empty-state__icon {
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  .comparison-empty-state__icon svg {
    color: var(--color-foreground-secondary, #666);
  }

  .comparison-empty-state__title {
    margin: 0 0 0.5rem 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-foreground);
  }

  .comparison-empty-state__description {
    margin: 0;
    font-size: 0.875rem;
    line-height: 1.5;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .comparison-controls__header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .comparison-controls__actions {
      flex-direction: column;
    }

    .comparison-controls__actions .button {
      width: 100%;
      justify-content: center;
    }

    .comparison-display__header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .comparison-display__actions {
      width: 100%;
      flex-direction: column;
    }

    .comparison-display__actions .button {
      width: 100%;
      justify-content: center;
    }

    .comparison-product-list {
      flex-direction: column;
    }

    .comparison-product-item {
      width: 100%;
    }
  }

  /* Loading State */
  .comparison-controls--loading,
  .comparison-display--loading {
    opacity: 0.6;
    pointer-events: none;
  }

  /* Hidden State */
  .comparison-controls--hidden,
  .comparison-display--hidden {
    display: none;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Product Comparison",
  "tag": "section",
  "class": "section-product-comparison",
  "settings": [
    {
      "type": "header",
      "content": "Comparison Controls"
    },
    {
      "type": "checkbox",
      "id": "show_comparison_controls",
      "label": "Show comparison controls",
      "default": true
    },
    {
      "type": "text",
      "id": "title",
      "label": "Controls title",
      "default": "Product Comparison"
    },
    {
      "type": "text",
      "id": "add_button_text",
      "label": "Add button text",
      "default": "Add to Comparison"
    },
    {
      "type": "text",
      "id": "remove_button_text",
      "label": "Remove button text",
      "default": "Remove from Comparison"
    },
    {
      "type": "text",
      "id": "view_button_text",
      "label": "View button text",
      "default": "View Comparison"
    },
    {
      "type": "text",
      "id": "clear_button_text",
      "label": "Clear button text",
      "default": "Clear All"
    },
    {
      "type": "checkbox",
      "id": "show_product_list",
      "label": "Show product list",
      "default": true
    },
    {
      "type": "header",
      "content": "Comparison Table"
    },
    {
      "type": "checkbox",
      "id": "show_comparison_table",
      "label": "Show comparison table",
      "default": true
    },
    {
      "type": "text",
      "id": "comparison_title",
      "label": "Comparison title",
      "default": "Product Comparison"
    },
    {
      "type": "text",
      "id": "export_button_text",
      "label": "Export button text",
      "default": "Export PDF"
    },
    {
      "type": "text",
      "id": "share_button_text",
      "label": "Share button text",
      "default": "Share"
    },
    {
      "type": "text",
      "id": "empty_title",
      "label": "Empty state title",
      "default": "No Products to Compare"
    },
    {
      "type": "text",
      "id": "empty_description",
      "label": "Empty state description",
      "default": "Add products to comparison to see side-by-side specifications."
    },
    {
      "type": "header",
      "content": "Settings"
    },
    {
      "type": "range",
      "id": "max_products",
      "label": "Maximum products",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "checkbox",
      "id": "auto_show_comparison",
      "label": "Auto show comparison when products added",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "persist_state",
      "label": "Remember comparison across pages",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "highlight_differences",
      "label": "Highlight specification differences",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "mobile_stack_layout",
      "label": "Stack comparison on mobile",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Product Comparison"
    }
  ]
}
{% endschema %}

<link rel="stylesheet" href="{{ 'print-styles.css' | asset_url }}" media="print">
<link rel="stylesheet" href="{{ 'product-specification-theme-integration.css' | asset_url }}">